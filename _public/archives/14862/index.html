<!DOCTYPE html>
<html lang="zh-cn">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.41" />
  <meta name="author" content="Peng Zhao">
  <meta name="description" content="Post-doc in Geoecology">

  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="/css/highlight.min.css">
    
  
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  <link rel="stylesheet" href="/css/hugo-academic.css">
  

  <link rel="alternate" href="http://www.pzhao.org/index.xml" type="application/rss+xml" title="Peng Zhao">
  <link rel="feed" href="http://www.pzhao.org/index.xml" type="application/rss+xml" title="Peng Zhao">

  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/apple-touch-icon.png">

  <link rel="canonical" href="http://www.pzhao.org/archives/14862/">

  

  <title>R 菜鸟入门篇 第10篇 函数和包 | Peng Zhao</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">切换导航</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/zh/">Peng Zhao</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="/zh/#about">
            
            <span>关于</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/tags/news">
            
            <span>新闻</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/tags/post">
            
            <span>日志</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/publication">
            
            <span>论文</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/talk">
            
            <span>报告</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/#projects">
            
            <span>项目</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/#teaching">
            
            <span>教学</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/#unclassified">
            
            <span>其他</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="https://cse.google.com/cse/publicurl?cx=006346710622437628329:nxozn9fijm0">
            
            <span>搜索</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/en">
            
            <span>EN</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  

  <div class="article-container">
    <h1 itemprop="name">R 菜鸟入门篇 第10篇 函数和包</h1>
    

<div class="article-metadata">

  <span class="article-date">
    <time datetime="2013-03-26 06:48:43 &#43;0000 &#43;0000" itemprop="datePublished">
      Tue, Mar 26, 2013
    </time>
  </span>

  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="/zh/categories/%e6%9c%aa%e5%88%86%e7%b1%bb">未分类</a
    >
    
  </span>
  
  

  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="/zh/tags/r">R</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=http%3a%2f%2fwww.pzhao.org%2farchives%2f14862%2f"
         target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=R%20%e8%8f%9c%e9%b8%9f%e5%85%a5%e9%97%a8%e7%af%87%20%e7%ac%ac10%e7%af%87%20%e5%87%bd%e6%95%b0%e5%92%8c%e5%8c%85&amp;url=http%3a%2f%2fwww.pzhao.org%2farchives%2f14862%2f"
         target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fwww.pzhao.org%2farchives%2f14862%2f&amp;title=R%20%e8%8f%9c%e9%b8%9f%e5%85%a5%e9%97%a8%e7%af%87%20%e7%ac%ac10%e7%af%87%20%e5%87%bd%e6%95%b0%e5%92%8c%e5%8c%85"
         target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=http%3a%2f%2fwww.pzhao.org%2farchives%2f14862%2f&amp;title=R%20%e8%8f%9c%e9%b8%9f%e5%85%a5%e9%97%a8%e7%af%87%20%e7%ac%ac10%e7%af%87%20%e5%87%bd%e6%95%b0%e5%92%8c%e5%8c%85"
         target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=R%20%e8%8f%9c%e9%b8%9f%e5%85%a5%e9%97%a8%e7%af%87%20%e7%ac%ac10%e7%af%87%20%e5%87%bd%e6%95%b0%e5%92%8c%e5%8c%85&amp;body=http%3a%2f%2fwww.pzhao.org%2farchives%2f14862%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

    <div class="article-style" itemprop="articleBody">
      

<p>终于轮到介绍 <strong>R</strong> 的精髓了，那就是包，package。欲知包，必先知函数，function。</p>

<p>我们已经遇到过很多函数了。<strong>R</strong> 中大多数工作都是函数完成的。经验告诉我们，调用函数的格式是：<code>函数名(变量1 = 某个值，变量2 = 某个值，...)</code>。我们以前用过的，都是 <strong>R</strong> 基础安装包里有限的一些预先设置好的函数。比如：</p>

<pre><code class="r">x &lt;- 1:5
sd(x)  # sd 是函数名, x 是自变量。
</code></pre>

<pre><code>## [1] 1.581
</code></pre>

<p><code>sd()</code>用来计算标准差。当我们发出这条指令时，<strong>R</strong> 在幕后到底忙活个啥呢？输入函数名就能看到了：</p>

<pre><code class="r">sd
</code></pre>

<pre><code>## function (x, na.rm = FALSE) 
## {
##     if (is.matrix(x)) {
##         msg &lt;- &quot;sd(&lt;matrix&gt;) is deprecated.\n Use apply(*, 2, sd) instead.&quot;
##         warning(paste(msg, collapse = &quot;&quot;), call. = FALSE, domain = NA)
##         apply(x, 2, sd, na.rm = na.rm)
##     }
##     else if (is.vector(x)) 
##         sqrt(var(x, na.rm = na.rm))
##     else if (is.data.frame(x)) {
##         msg &lt;- &quot;sd(&lt;data.frame&gt;) is deprecated.\n Use sapply(*, sd) instead.&quot;
##         warning(paste(msg, collapse = &quot;&quot;), call. = FALSE, domain = NA)
##         sapply(x, sd, na.rm = na.rm)
##     }
##     else sqrt(var(as.vector(x), na.rm = na.rm))
## }
## &lt;bytecode: 0x0576f9bc&gt;
## &lt;environment: namespace:stats&gt;
</code></pre>

<p>甚至 <code>x &lt;- 1:5</code> 这一句，其实背后运行的也是个函数，等同于：</p>

<pre><code>assign(&quot;x&quot;, 1:5)
</code></pre>

<p>内置函数虽然功能强大，但是毕竟有限，要是能随心所欲自己定义新函数就好了。这一点 <strong>R</strong> 贴心地考虑到了。比如说，当年有一回全班考得都很惨，老师心软了，说为了提高及格率，把卷面分数开方乘十作为新分数吧。为了以后经常用来提高及格率，我们可以专门定义这样一个函数，完全仿照内置函数的格式：</p>

<pre><code class="r">newscore &lt;- function(x) # newscore 是自定义的函数名，它有一个自变量 x。函数的返回值是 sqrt(x) * 10。
{
sqrt(x) * 10
}
</code></pre>

<p>以后当考了40分的时候，可以这样调用你的新函数：</p>

<pre><code class="r">newscore(x = 40)
</code></pre>

<pre><code>## [1] 63.25
</code></pre>

<p><em>开胃小菜：更妙的操作方式，想一次可以用很久喔！有人說，學電腦的人，動腦筋就是為了偷懶。&ndash; 语出<a href="http://www.study-area.org/tips/vim/index.html" target="_blank">大家來學VIM</a></em></p>

<p>上面这个例子中，自变量 x 只是用来在函数内部传递信息用的，不会影响函数之外的对象。看看这个例子：</p>

<pre><code class="r">x &lt;- 36
y &lt;- 81
newscore(x = y)  # 函数内部的 x 把 81 的值传递进来，而不是36。
</code></pre>

<pre><code>## [1] 90
</code></pre>

<p>可以有多个自变量：</p>

<pre><code class="r">news &lt;- function(x, n) {
    sqrt(x) * 10 + n
}
news(x = 36, n = 10)
</code></pre>

<pre><code>## [1] 70
</code></pre>

<pre><code class="r">news(36, 10)  # 懒人为了省事儿，按自变量的默认顺序写就行了。
</code></pre>

<pre><code>## [1] 70
</code></pre>

<pre><code class="r">news(n = 10, x = 36)  # 如果打乱顺序，就必须指定谁是谁。
</code></pre>

<pre><code>## [1] 70
</code></pre>

<p>每次调用自定义函数 newscore 的时候，必须提供所有自变量的取值，否则就会报错：</p>

<pre><code class="r">newscore()
</code></pre>

<pre><code>## Error: &amp;#39;x&amp;#39; is missing
</code></pre>

<p>为避免这个问题，需要给个默认值：</p>

<pre><code class="r">newscore &lt;- function(x = 36) # x 默认是 36。
{
sqrt(x) * 10
}
newscore()
</code></pre>

<pre><code>## [1] 60
</code></pre>

<p>给函数定义时，我们用了花括号{}，这意味着可以把一组操作都放进去，哪怕这一组操作有千万行，以后只用一行就可以调用一遍了！比如第 05 篇提到过的指数增长，可以定义一个函数<code>exponentialGrowth</code>：</p>

<pre><code class="r">exponentialGrowth &lt;- function(N0, r = 0.01, tmax = 10) # 三个自变量：初始值，增长率，时间。
{
  N &lt;- N0
  for (t in 1 : (tmax - 1)) {
     N[t + 1] &lt;- N[t] + r * N[t]
  }
  N # 这是最后一行，作为函数的返回值。
}

exponentialGrowth(66.8)
</code></pre>

<pre><code>##  [1] 66.80 67.47 68.14 68.82 69.51 70.21 70.91 71.62 72.33 73.06
</code></pre>

<pre><code class="r">plot(exponentialGrowth(66.8, 0.01, 100))
</code></pre>

<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfgAAAH4CAMAAACR9g9NAAAAgVBMVEX9/v0AAAAAAEYAAHMARkYARpoAdHMAdL1GAABGAEZGAHNGRnNGRppGm95zAABzAEZzAHNzRgBzRppzdHNzvv2aRgCaRkaaRnOadACavpqa396a3/29dAC9dEa9/r29/t69/v3em0be35re/r3e/t7e/v39vnP935r9/r39/t79/v0W3EiWAAAAK3RSTlP///////////////////////////////////////////////////////8AI8mn0AAAAAlwSFlzAAALEgAACxIB0t1+/AAADyxJREFUeJztnQlz27oVRp+SunZS2y9N5XSR0pp9tSTz///AEpToeBEhkACI5TtnJpOZKL6UfHQvNoL4rQVJfkv9BiANiBcF8aIgXhTEi4J4URAvCuJFQbwoiBcF8aIgXhTEi4J4URAvCuJFQbwoiBcF8aIgXhTEi4J4URAvCuJFQbwoiBcF8aIgXhTEi4J4URAvCuJFQbwoiBcF8aIgXhTEi4J4URAvCuJFQbwoiBcF8aIgXhTEi4J4URAvCuJFQbwoiBcF8aIgXhTEi4J4URAvCuJFQbwoiBfFR/wKcsZX/P6mD/P58aP4ud8YWABv8du7/q/d1dPE0JAUX/HPPzb934dvH1Ie8TnjLf6BjC8S71L//EAbXyLe4meHhqQgXhRv8Yf71XVDqS8Ob/E/N21z3Q3nb+ncFUWI4Vxz92Y45zg3BEkh40V4n4i08Rqs2ndC6NVrgHhREK9K8DbecimPn4XY+C/SnMZuH3t3iM+Fc0Nr/4w/Lcifudzln4Ul+NC+t+f+4S0O4g+/b8avBxkQSbz1epABiFclThs/fjmPn4VQjK2ZIL5uzpb5duwff4H4wkG8KIhXhTZeENvNMIivl9Ey39peOIL4gkG8KIhXhTYePoD4Srl0ezvi68TavreXXkR8sSBeFMSrQhuviMPGRcRXyMU6f/l1xJcI4kVBvCq08YI4PpEC8ZXhUuaH/2cB8aWBeFEQrwptvCATHjWG+IpwLfPD/7WA+JJAvCiIV4U2XpCJz5BFfCVMKfPD/7eA+FJAvCiIV4U2XpAZhwMgvgKmlvnhZywgvgQQL0oS8RwqnAEp2ngOFU7MzFOffMVzqHBi5pT54ecscKhw7qQSz6HCiUkm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" alt="plot of chunk unnamed-chunk-9" /></p>

<pre><code>练习10.1 自定义一个名为 kaifang 的函数，用来开平方。
练习10.2 自定义一个名为 cv 的函数，用来计算变异系数，即 标准差除以平均值的商。
</code></pre>

<p>上面我们自定义了几个函数。世界上很多角落都有想把 36 分变成 60 分的苦命同学，为了让他们也能方便地调用我们自定义的函数，我们可以把它们打包上传到服务器上，这样别人下载了就可以直接用。这就是包。包就是一组预设函数的集合，有时候也包含一些数据。一个包里可能只有一个函数，也可能有成千上万个。<strong>R</strong> 能走到今天，是一个聚沙成塔、集腋成裘的过程，其中的沙和腋，正是众多热心人花心血写成并奉献出来的扩展包。每个人献出一滴水，终于创造出如今的汪洋大海任你畅游。到底有多少个扩展包呢？用这条命令：</p>

<pre><code>length(unique(rownames(available.packages()))) 
</code></pre>

<p>扩展包是 <strong>R</strong> 的生命力所在。找到一个合适的扩展包，能起到事半功倍的效果。甚至可以说，会用扩展包，比本文前9篇介绍的所有内容都重要！很多人用 <strong>R</strong> 就是奔着扩展包来的。</p>

<p>还是举个例子吧。</p>

<p>北京有个著名的广场，常年根据预测的日出日落时间来确定<a href="http://www.tiananmen.org.cn/flag/index.asp" target="_blank">升降国旗仪式的时间</a>，这个是怎么预测的？参看<a href="http://www.ubeijing.cn/zhinan/2557.html" target="_blank">这里</a>。日出日落时间的计算是可以当作<a href="http://news.lnd.com.cn/htm/2008-07/07/content_236459.htm" target="_blank">新闻</a>来报导的，这让 dapeng 觉得挺神秘。直到有一天，dapeng 需要把某个观测点半年的气温数据（每半小时一条）分为白天和黑夜两组，那么就要判断当地每天的日出和日落时间，不得不设法揭开这个神秘面纱了。上网一搜，哦买告的，计算过程不是一般的复杂啊（见<a href="http://www.joyloft.net/?p=456" target="_blank">这里</a>），需要有三角函数知识、立体几何知识、天文学知识等等等等，最要命的是还得有足够的耐心。dapeng 花了大概一天的工夫，硬着头皮算出了个数，却跟实际对不上号。</p>

<p>后来，惊喜地发现了 maptools 这个扩展包，安装这个包之后，用其中的 <code>sunriset()</code> 函数一条指令轻松搞定。前天是一个重要的日子，我们计算一下当天的升降国旗时间。</p>

<pre><code>install.packages(&quot;maptools&quot;) # 第一次使用某个扩展包时要先安装。
</code></pre>

<pre><code class="r">require(maptools)  # 调用扩展包，让 R 识别其中的函数。
</code></pre>

<pre><code>## Loading required package: maptools


## Warning: package &amp;#39;maptools&amp;#39; was built under R version 2.15.3


## Loading required package: foreign


## Loading required package: sp


## Warning: package &amp;#39;sp&amp;#39; was built under R version 2.15.3


## Loading required package: grid


## Loading required package: lattice


## Checking rgeos availability: FALSE Note: when rgeos is not available,
## polygon geometry computations in maptools depend on gpclib, which has a
## restricted licence. It is disabled by default; to enable gpclib, type
## gpclibPermit()
</code></pre>

<pre><code class="r">position &lt;- c(116.39, 39.91)  # 旗杆的经纬度。
mydate &lt;- "2013-03-24"  # 要计算的日期。
sunriset(matrix(position, nrow = 1), as.POSIXct(mydate, tz = "Asia/Shanghai"), 
    direction = c("sunrise"), POSIXct.out = TRUE)$time  # 日出时间。
</code></pre>

<pre><code>## [1] &quot;2013-03-24 06:11:53 CST&quot;
</code></pre>

<pre><code class="r">sunriset(matrix(position, nrow = 1), as.POSIXct(mydate, tz = "Asia/Shanghai"), 
    direction = c("sunset"), POSIXct.out = TRUE)$time  # 日落时间。
</code></pre>

<pre><code>## [1] &quot;2013-03-24 18:30:15 CST&quot;
</code></pre>

<p>跟官方公布的一点也不差。一个完整的扩展包包括了帮助信息，所以我们的法宝问号仍然管用。自己试试 &lsquo;?sunriset&rsquo;。若要了解整个扩展包中所有的函数，可以 google 搜索 &lsquo;cran maptools&rsquo;，也可以在本地计算机 <strong>R</strong> 的安装路径下面 library 文件夹中找到。</p>

<p>让我们更进一步，自定义一个函数，计算该广场任意一段时期的升降旗时刻：</p>

<pre><code class="r">flag &lt;- function(date.start = "2013-03-24", date.length = 7) # 函数名为flag，默认是计算从前天起一周的升降器时刻。
{
mydate &lt;- seq(as.POSIXct(date.start, tz="Asia/Shanghai"), by = 3600 * 24, length.out = date.length)
data.frame(sunrise = sunriset(matrix(c(116.39, 39.91), nrow = 1), as.POSIXct(mydate, tz="Asia/Shanghai"), direction=c("sunrise"), POSIXct.out = TRUE)$time,
sunset = sunriset(matrix(c(116.39, 39.91), nrow = 1), as.POSIXct(mydate, tz="Asia/Shanghai"), direction=c("sunset"), POSIXct.out = TRUE)$time)
}

flag("2013-10-01") # 好了，以后调用这个函数就能很方便计算。
</code></pre>

<pre><code>##               sunrise              sunset
## 1 2013-10-01 06:10:24 2013-10-01 17:57:17
## 2 2013-10-02 06:11:22 2013-10-02 17:55:40
## 3 2013-10-03 06:12:21 2013-10-03 17:54:03
## 4 2013-10-04 06:13:20 2013-10-04 17:52:27
## 5 2013-10-05 06:14:20 2013-10-05 17:50:51
## 6 2013-10-06 06:15:19 2013-10-06 17:49:16
## 7 2013-10-07 06:16:19 2013-10-07 17:47:41
</code></pre>

<p>如果你懒得自己算，只想知道某地的日出日落时刻，请给 dapeng 留言。<a href="http://pzhao.org/sunriset" target="_blank">这里</a>是已经计算的北京等地今后三年的日出日落时刻表。</p>

<pre><code>练习10.3 利用google earth 查出你所在地点的经纬度，然后利用 maptools 扩展包，计算你所在地点 2013 -2113 年 100 年的日出日落时间，然后通知记者来报导“退休职工某某某计算出某地日出日落时间表”。
</code></pre>

<p>再举个例子。谢益辉开发了一个制作动画的扩展包，很有趣：</p>

<pre><code>install.packages(&quot;animation&quot;)
require(animation)
demo(&quot;fireworks&quot;) # 会用网页浏览器打开一个动画。
citation(&quot;animation&quot;) # 看看作者。
</code></pre>

<p>看着那些琳琅满目的扩展包，dapeng 有种逛苹果商场看app的感觉。网上看到说，<a href="http://i.ifeng.com/video/fhtese/qqsrx/news?vt=5&amp;aid=56044505&amp;mid=&amp;m=1" target="_blank">“陈红是陈凯歌的第四任妻子，从此之后，陈凯歌再也没有过绯闻。记者采访陈红，拴住大导演的心的秘诀是什么？陈红简单的回答，做百变女人。”</a>扩展包让 <strong>R</strong> 成了魅力十足的百变女人，教人如何不爱她？</p>

<h2 id="有用的信息">有用的信息：</h2>

<table>
<thead>
<tr>
<th>&#8211;</th>
<th>&#8211;</th>
</tr>
</thead>

<tbody>
<tr>
<td>自定义函数</td>
<td><code>function()</code></td>
</tr>

<tr>
<td>扩展包</td>
<td><code>install.packages(), require(), citation()</code></td>
</tr>
</tbody>
</table>

<p>( <em>连载中，待续</em> )</p>

<p>yangliufr 网友提了个好建议，希望给代码加上高亮。dapeng 试了一下，下面是个例子。但是 dapeng 懒得一一去改了，多包涵，凑合着看吧。</p>

<pre lang="rsplus">flag &lt;- function(date.start = "2013-03-24", date.length = 7) # 函数名为flag，默认是计算从前天起一周的升降器时刻。
{
mydate &lt;- seq(as.POSIXct(date.start, tz="Asia/Shanghai"), by = 3600 * 24, length.out = date.length)
data.frame(sunrise = sunriset(matrix(c(116.39, 39.91), nrow = 1), as.POSIXct(mydate, tz="Asia/Shanghai"), direction=c("sunrise"), POSIXct.out = TRUE)$time, sunset = sunriset(matrix(c(116.39, 39.91), nrow = 1), as.POSIXct(mydate, tz="Asia/Shanghai"), direction=c("sunset"), POSIXct.out = TRUE)$time)
}
flag("2013-10-01") # 好了，以后调用这个函数就能很方便计算。
</pre>

<p><a href="http://dapengde.com/archives/14862" target="_blank">原文链接</a></p>

    </div>
  </div>

</article>

<div class="container">
  <nav>
  <ul class="pager">
    
    <li class="previous"><a href="http://www.pzhao.org/archives/14858/"><span
      aria-hidden="true">&larr;</span> R 菜鸟入门篇 第09篇 字符串</a></li>
    

    
    <li class="next"><a href="http://www.pzhao.org/archives/14905/">R 菜鸟入门篇 第11篇 空间数据 <span
      aria-hidden="true">&rarr;</span></a></li>
    
  </ul>
</nav>

</div>

<div class="article-container">
  
<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "pzhao" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>


</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2017 Peng Zhao &middot; 

      Powered by the <a href="https://github.com/gcushen/hugo-academic" target="_blank">Academic
      theme</a> for <a href="http://gohugo.io" target="_blank">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="/js/jquery-1.12.3.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="/js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-99744900-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    <script async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML"></script>
    

  </body>
</html>

