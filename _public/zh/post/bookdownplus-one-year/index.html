<!DOCTYPE html>
<html lang="zh-cn">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.41" />
  <meta name="author" content="Peng Zhao">
  <meta name="description" content="Post-doc in Geoecology">

  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="/css/highlight.min.css">
    
  
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  <link rel="stylesheet" href="/css/hugo-academic.css">
  

  <link rel="alternate" href="http://www.pzhao.org/index.xml" type="application/rss+xml" title="Peng Zhao">
  <link rel="feed" href="http://www.pzhao.org/index.xml" type="application/rss+xml" title="Peng Zhao">

  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/apple-touch-icon.png">

  <link rel="canonical" href="http://www.pzhao.org/zh/post/bookdownplus-one-year/">

  

  <title>外行 R 包开发手记：bookdownplus | Peng Zhao</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">切换导航</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/zh/">Peng Zhao</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="/zh/#about">
            
            <span>关于</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/tags/news">
            
            <span>新闻</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/tags/post">
            
            <span>日志</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/publication">
            
            <span>论文</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/talk">
            
            <span>报告</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/#projects">
            
            <span>项目</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/#teaching">
            
            <span>教学</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/zh/#unclassified">
            
            <span>其他</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="https://cse.google.com/cse/publicurl?cx=006346710622437628329:nxozn9fijm0">
            
            <span>搜索</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/en">
            
            <span>EN</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  

  <div class="article-container">
    <h1 itemprop="name">外行 R 包开发手记：bookdownplus</h1>
    

<div class="article-metadata">

  <span class="article-date">
    <time datetime="2018-10-18 00:00:00 &#43;0000 UTC" itemprop="datePublished">
      Thu, Oct 18, 2018
    </time>
  </span>

  
  
  
  

  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="/zh/tags/post">post</a
    >, 
    
    <a href="/zh/tags/bookdown">bookdown</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=http%3a%2f%2fwww.pzhao.org%2fzh%2fpost%2fbookdownplus-one-year%2f"
         target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=%e5%a4%96%e8%a1%8c%20R%20%e5%8c%85%e5%bc%80%e5%8f%91%e6%89%8b%e8%ae%b0%ef%bc%9abookdownplus&amp;url=http%3a%2f%2fwww.pzhao.org%2fzh%2fpost%2fbookdownplus-one-year%2f"
         target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fwww.pzhao.org%2fzh%2fpost%2fbookdownplus-one-year%2f&amp;title=%e5%a4%96%e8%a1%8c%20R%20%e5%8c%85%e5%bc%80%e5%8f%91%e6%89%8b%e8%ae%b0%ef%bc%9abookdownplus"
         target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=http%3a%2f%2fwww.pzhao.org%2fzh%2fpost%2fbookdownplus-one-year%2f&amp;title=%e5%a4%96%e8%a1%8c%20R%20%e5%8c%85%e5%bc%80%e5%8f%91%e6%89%8b%e8%ae%b0%ef%bc%9abookdownplus"
         target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=%e5%a4%96%e8%a1%8c%20R%20%e5%8c%85%e5%bc%80%e5%8f%91%e6%89%8b%e8%ae%b0%ef%bc%9abookdownplus&amp;body=http%3a%2f%2fwww.pzhao.org%2fzh%2fpost%2fbookdownplus-one-year%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

    <div class="article-style" itemprop="articleBody">
      <blockquote>
<p>春有百花秋有月，夏有凉风冬有雪 。</p>

<p>若无闲事挂心头，便是人间好时节。</p>
</blockquote>

<p><a href="http://www.pzhao.org/zh/post/shadowed-images/" target="_blank">上回</a>提了一句，说被自己开发的 bookdownplus 包给坑了。受它和其他几个 R 包所累，这一年来，我总想关起门窗，静静清除包包里的几只 bugs，不清掉的话实在睡不香。于是乎，把阿尔卑斯山的春花秋月全都错过了。</p>

<p>简单来说，被坑的原因只有一个：没有金刚钻，硬揽瓷器活。</p>

<p>bookdownplus 诞生之前，《<a href="http://xuer.pzhao.org" target="_blank">学 R：零基础学习 R 语言</a>》一书刚刚完稿，我正处于摸索 bookdown 的兴奋期。当时遇见了三件事：第一是 RStudio IDE 还不具备直接创建 bookdown 项目的功能（比如说每次都要从源头拷贝一份 .Rproj 文件），第二是我头一回接触 yaml（每次都要翻书），第三是我电脑里有一堆尘封已久的 LaTeX 模板，食之无肉，弃之有味。</p>

<p>这三件事，任何一件孤立起来，都直接翻篇儿，然而叠加起来，产生了协同效应。我先是把常用的文件整理成了一个 Github 项目，并且写了个 R 脚本，灭掉了这三个问题。后来心念一动：写都写了，不如把这个脚本写成个 R 包，发到 CRAN 上分享！</p>

<p>一失足成千古恨。现在回头去看，这是未来一年里一切灾难的开始。</p>

<p>R 脚本，自用是一回事，而分享，完全是另一回事。哪怕这只是最简单不过的一个包。</p>

<p>第一个坑很快来了，那就是包的命名：这个包叫什么好？</p>

<p>这个坑说大不大，说小不小。说它不大，是因为不重要，不论起多好的名字，烂包不会变好包；说它不小，是因为为它花的时间比预计得要多。</p>

<p>原想叫 bd，意思是 bookdown 的简化，但猛一看让人摸不着头脑；</p>

<p>后来想叫 bookup，梦想着跟 bookdown 出双入对，但细想却好像是跟 bookdown 对着干；</p>

<p>最后，选择了 bookdownplus，长是长了点，但好处是在 CRAN 的包列表里紧随 bookdown，亦步亦趋；并且，用 <code>library()</code> 加载 bookdown 时，如果按 tab 自动补全的话，会有 bookdownplus 的提示。我还为 bookdownplus 做了个 logo，由三个元素构成：book，down，plus。</p>

<p>瞧我是有多闲。</p>

<p><img src="https://bookdownplus.netlify.com/img/bookdownplus-logo.png" alt="" /></p>

<p>第二个坑，是发布到 CRAN。没想到有那么多讲究。</p>

<p>一个包，在本地电脑里运行得好好的，然而想发布到 CRAN，就得先自检。当然，这个得感谢 RStudio，让人只需点个按钮，就能模拟提交到 CRAN 会遇到的警告，然而这只是降低了入门的门槛；迈进门槛之后，该受的虐一个也少不了。</p>

<p>依赖的包没导入，不行；导入的包没使用，也不行；函数没举例子，不行；函数举了例子万一出错，也不行；甚至函数的标题里，单词首字母的大小写写错都不行。有时候，光提交就能耗进去半天。自检出来的 Warnings，Errors 以及 Notes，哪怕解决之后，CRAN 管理员仍然会在回复邮件指出各种错误，这足够一个业余程序员怀疑人生了。</p>

<p>后来，我做出一个决定：升级到 github 就够了。至于提交到 CRAN，还是算了吧，除非万不得已。</p>

<p>第三个坑，是兼容性。</p>

<p>我是个 Windows 用户；这个包只在 Windows 下测试过。更准确地说，只在 Windows 7 下测试过。发布之后就得到反馈，说某个模板在 Mac 或 Linux 下出现这样那样的故障。作为开发者，自然而然地想到去同样的环境下测试，那么问题就来了：装个 Linux？虚拟的 Ubuntu 我是装过，但只是玩玩而已，现在要测试，就得升级 R——光升级 R 就用尽了我的洪荒之力。这还是好的，更糟的是 Mac 环境，我怎么去虚拟？</p>

<p>嘿，还别说，我还真的下载了个黑苹果系统，结果装上一试啊，电脑死慢，动一下鼠标，等 5 秒钟，显示器上的鼠标箭头终于颤抖了一下，告诉我它其实没死，只是活得有点累而已。</p>

<p>如此这般折腾一圈，我才想起来自己最初想要做什么——不就是把几行代码分享出去吗，至于这么麻烦？</p>

<p>第四个坑，是升级。不是 bookdownplus 本身升级，而是依赖的工具链升级。</p>

<p>bookdownplus 依赖的工具链很长，其中任何一个环节发生变化，都有可能导致 bookdownplus 挂掉。</p>

<p>有一次，用户反映，由于 pandoc 的升级，原先的<code>pandoc_args:  --chapters</code>，要改成 <code>pandoc_args:  --top-level-division=chapter</code>，不然就会出现警告。</p>

<p>对我这种得过且过的人来说，警告就警告呗，我装作没看见，不影响结果就行。但是，bookdownplus 的用户显然要求更高一些，多人多次提出这个问题。</p>

<p>要说改起来也容易，不就是拷贝粘贴一下嘛。然而，bookdownplus 本质上是个模板库，我得把所有的几十个模板都改一轮。这时我就开始质疑包的开发者了：这是架构得有多差，明明只是一个问题，却要改多处？这包是谁开发的？</p>

<p>哦，这才想起来，这包是我开发的。</p>

<p>有一段时间，我用 bookdownplus 的一个模板干正经事，干了一半，放下做别的，一放好多天。期间，我大概是升级了 R，RStudio，MikTeX 里的某些包，可能还包括 pandoc，bookdown，rmarkdown，knitr……说不清楚。然后回来接着干正经事，莫名其妙地发现，编译失败。找原因？要命的是，上面任何一处都有可能是原因。更要命的是，这些我全不熟。</p>

<p>好吧，我就坐等 bookdownplus 的用户来提意见。</p>

<p>就这样被坑了多次，坑得反复怀疑人生：bookdownplus 这个包有意义吗？我适合做开发吗？分享这个包，到底是为了所谓贡献，还是出于虚荣？就像《学 R》一书“函数”一章里写到的：</p>

<blockquote>
<p>以铜为鉴，可正衣冠；</p>

<p>以古为鉴，可知兴替；</p>

<p>以人为鉴，可明得失：</p>

<p>以 R 包为鉴，可知本我，自我，超我。</p>
</blockquote>

<p>bookdownplus 的本质有两个：(1) 它是个创建 bookdown 项目的便捷方式，(2)它是个模板库。它的核心代码不过区区几十行。当初凭一时热情创建，而后来的一年里，尤其是写进《学 R》一书之后，我不断怀疑它存在的意义。</p>

<p>RStudio 目前已经可以直接创建 bookdown 项目，所以第一点意义已经不大。而作为模板库，我没有精力去维护几十个 LaTeX 模板。</p>

<p>最近， RStudio 官方举办了 bookdown 大奖赛。我觉得，是时候做个了断了。</p>

<p>借大奖赛的机会，我完善和添加了北京大学和中国科学院大学的学位论文模板， 算是了了一桩心愿。同时，对 bookdownplus 做出了一次最大的升级，那就是把 bookdownplus 改成了链接到 bookdown 模板的桥梁。除了自带几个模板外，我把其他模板都移了出去。并且，任何人都可以往 bookdownplus 提交自己创建或自己发现的 bookdown 模板，只需向模板展示网站 <a href="https://bookdownplus.netlify.com/about/" target="_blank">bookdownplus gallery</a> 提交一篇介绍文字即可。接受之后，就可以直接用 bookdownplus 来下载安装了。</p>

<p>谁的模板谁维护，bookdownplus 只是引荐一下。</p>

<p>我打算从此去享受我的夏风冬雪。</p>

    </div>
  </div>

</article>

<div class="container">
  <nav>
  <ul class="pager">
    
    <li class="previous"><a href="http://www.pzhao.org/zh/post/desheng-5/"><span
      aria-hidden="true">&larr;</span> 5 岁</a></li>
    

    
    <li class="next"><a href="http://www.pzhao.org/zh/post/pinyin-one-year/">外行 R 包开发手记：pinyin <span
      aria-hidden="true">&rarr;</span></a></li>
    
  </ul>
</nav>

</div>

<div class="article-container">
  
<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "pzhao" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>


</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2017 Peng Zhao &middot; 

      Powered by the <a href="https://github.com/gcushen/hugo-academic" target="_blank">Academic
      theme</a> for <a href="http://gohugo.io" target="_blank">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="/js/jquery-1.12.3.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="/js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-99744900-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    <script async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML"></script>
    

  </body>
</html>

